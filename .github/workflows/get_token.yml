name: Rclone Google Drive Test

on:
  workflow_dispatch: # 允许手动点击运行进行测试

jobs:
  test-connection:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Rclone
        run: |
          sudo apt-get update
          sudo apt-get install -y rclone

      - name: Setup Rclone Config
        run: |
          # 创建配置目录
          mkdir -p ~/.config/rclone
          # 将 Secret 写入配置文件
          cat << EOF > ~/.config/rclone/rclone.conf
          ${{ secrets.RCLONE_CONFIG_DATA }}
          EOF

      - name: Test 1 - List Directories
        run: |
          echo "正在连接 Google Drive..."
          rclone lsd gdrive:
          echo "目录列表获取成功！"

      - name: Test 2 - Upload a Test File
        run: |
          echo "rclone 测试文件 - 运行时间: $(date)" > test-file.txt
          echo "正在上传测试文件到网盘根目录..."
          rclone copy test-file.txt gdrive:/ -v
          echo "文件上传成功！请前往 Google Drive 查看 test-file.txt"
